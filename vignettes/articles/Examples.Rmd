---
title: "Fitting and Predicting with parsnip"
vignette: >
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteIndexEntry{Fitting and Predicting with parsnip}
output:
  knitr:::html_vignette
---

```{r startup, include = FALSE}
library(utils)
library(ggplot2)
theme_set(theme_bw())
```

This is a collection of examples for fitting and predicting with various models and engines. 

Model/engine combinations which can be used for different modes have an example each. For regression, we use the Chicago ridership data. For classification, we use an artificial dataset for a binary example and the Palmer penguins data for a multi-class example.

<!-- The headings (<summary>) of the collapsible sections below include <foo></foo> so that the function name does not get auto-linked to the function's help page. This means clicking on the function name will open the collapsed section rather than take you to the help page. -->

  <details id="mars-earth"> 
  
  <summary><code>mars<foo></foo>()</code> with the `"earth"` engine</summary>

  ```{r echo=FALSE}
  knitr::spin_child("template-reg-chicago.R")
  ```

  We can define the model with specific parameters:

  ```{r}
  mars_reg_spec <- 
    mlp() %>% 
    # This model can be used for classification or regression, so set mode
    set_mode("regression") %>% 
    set_engine("nnet")
  mars_reg_spec
  ```

  Now we create the model fit object:

  ```{r}
  set.seed(1)
  mars_reg_fit <- mars_reg_spec %>% fit(ridership ~ ., data = Chicago_train)
  mars_reg_fit
  ```

  The holdout data can be predicted:

  ```{r}
  predict(mars_reg_fit, Chicago_test)
  ```


  ```{r echo=FALSE}
  knitr::spin_child("template-cls-two-class.R")
  ```

  We can define the model with specific parameters:

  ```{r}
  mars_cls_spec <- 
    mlp() %>% 
    # This model can be used for classification or regression, so set mode
    set_mode("classification") %>% 
    set_engine("nnet")
  mars_cls_spec
  ```

  Now we create the model fit object:

  ```{r}
  set.seed(1)
  mars_cls_fit <- mars_cls_spec %>% fit(Class ~ ., data = data_train)
  mars_cls_fit
  ```

  The holdout data can be predicted for both hard class predictions and probabilities. We'll bind these together into one tibble:

  ```{r}
  bind_cols(
    predict(mars_cls_fit, data_test),
    predict(mars_cls_fit, data_test, type = "prob")
  )
  ```
    
  </details>


  <details id="mlp-nnet"> 
  
  <summary><code>mlp<foo></foo>()</code> with the `"nnet"` engine</summary>

  ```{r echo=FALSE}
  knitr::spin_child("template-reg-chicago.R")
  ```

  We can define the model with specific parameters:

  ```{r}
  mlp_reg_spec <- 
    mlp() %>% 
    # This model can be used for classification or regression, so set mode
    set_mode("regression") %>% 
    set_engine("nnet")
  mlp_reg_spec
  ```

  Now we create the model fit object:

  ```{r}
  set.seed(1)
  mlp_reg_fit <- mlp_reg_spec %>% fit(ridership ~ ., data = Chicago_train)
  mlp_reg_fit
  ```

  The holdout data can be predicted:

  ```{r}
  predict(mlp_reg_fit, Chicago_test)
  ```


  ```{r echo=FALSE}
  knitr::spin_child("template-cls-two-class.R")
  ```

  We can define the model with specific parameters:

  ```{r}
  mlp_cls_spec <- 
    mlp() %>% 
    # This model can be used for classification or regression, so set mode
    set_mode("classification") %>% 
    set_engine("nnet")
  mlp_cls_spec
  ```

  Now we create the model fit object:

  ```{r}
  set.seed(1)
  mlp_cls_fit <- mlp_cls_spec %>% fit(Class ~ ., data = data_train)
  mlp_cls_fit
  ```

  The holdout data can be predicted for both hard class predictions and probabilities. We'll bind these together into one tibble:

  ```{r}
  bind_cols(
    predict(mlp_cls_fit, data_test),
    predict(mlp_cls_fit, data_test, type = "prob")
  )
  ```
    
  </details>
  
  <details id="mlp-keras"> 
  
  <summary><code>mlp<foo></foo>()</code> with the `"keras"` engine</summary>

  ```{r echo=FALSE}
  knitr::spin_child("template-reg-chicago.R")
  ```

  We can define the model with specific parameters:

  ```{r}
  mlp_reg_spec <- 
    mlp() %>% 
    # This model can be used for classification or regression, so set mode
    set_mode("regression") %>% 
    set_engine("keras")
  mlp_reg_spec
  ```

  Now we create the model fit object:

  ```{r}
  set.seed(1)
  mlp_reg_fit <- mlp_reg_spec %>% fit(ridership ~ ., data = Chicago_train)
  mlp_reg_fit
  ```

  The holdout data can be predicted:

  ```{r}
  predict(mlp_reg_fit, Chicago_test)
  ```


  ```{r echo=FALSE}
  knitr::spin_child("template-cls-two-class.R")
  ```

  We can define the model with specific parameters:

  ```{r}
  mlp_cls_spec <- 
    mlp() %>% 
    # This model can be used for classification or regression, so set mode
    set_mode("classification") %>% 
    set_engine("keras")
  mlp_cls_spec
  ```

  Now we create the model fit object:

  ```{r}
  set.seed(1)
  mlp_cls_fit <- mlp_cls_spec %>% fit(Class ~ ., data = data_train)
  mlp_cls_fit
  ```

  The holdout data can be predicted for both hard class predictions and probabilities. We'll bind these together into one tibble:

  ```{r}
  bind_cols(
    predict(mlp_cls_fit, data_test),
    predict(mlp_cls_fit, data_test, type = "prob")
  )
  ```
    
  </details>  
  
  
  <details id="multinom-reg-glmnet"> 

  <summary><code>multinom_reg<foo></foo>()</code> with the `"glmnet"` engine</summary>

  ```{r echo=FALSE}
  knitr::spin_child("template-cls-multi-class.R")
  ```

  We can define the model with specific parameters:

  ```{r}
  mr_cls_spec <- 
    multinom_reg(penalty = 0.1) %>% 
    set_engine("glmnet")
  mr_cls_spec
  ```

  Now we create the model fit object:

  ```{r}
  set.seed(1)
  mr_cls_fit <- mr_cls_spec %>% fit(island ~ ., data = penguins_train)
  mr_cls_fit
  ```

  The holdout data can be predicted for both hard class predictions and probabilities. We'll bind these together into one tibble:

  ```{r}
  bind_cols(
    predict(mr_cls_fit, penguins_test),
    predict(mr_cls_fit, penguins_test, type = "prob")
  )
  ```

  </details>


  <details id="multinom-reg-keras"> 

  <summary><code>multinom_reg<foo></foo>()</code> with the `"keras"` engine</summary>

  ```{r echo=FALSE}
  knitr::spin_child("template-cls-multi-class.R")
  ```

  We can define the model with specific parameters:

  ```{r}
  mr_cls_spec <- 
    multinom_reg(penalty = 0.1) %>% 
    set_engine("keras")
  mr_cls_spec
  ```

  Now we create the model fit object:

  ```{r}
  set.seed(1)
  mr_cls_fit <- mr_cls_spec %>% fit(island ~ ., data = penguins_train)
  mr_cls_fit
  ```

  The holdout data can be predicted for both hard class predictions and probabilities. We'll bind these together into one tibble:

  ```{r}
  bind_cols(
    predict(mr_cls_fit, penguins_test),
    predict(mr_cls_fit, penguins_test, type = "prob")
  )
  ```

  </details>


  <details id="multinom-reg-nnet"> 

  <summary><code>multinom_reg<foo></foo>()</code> with the `"nnet"` engine</summary>

  ```{r echo=FALSE}
  knitr::spin_child("template-cls-multi-class.R")
  ```

  We can define the model with specific parameters:

  ```{r}
  mr_cls_spec <- 
    multinom_reg(penalty = 0.1) %>% 
    set_engine("nnet")
  mr_cls_spec
  ```

  Now we create the model fit object:

  ```{r}
  set.seed(1)
  mr_cls_fit <- mr_cls_spec %>% fit(island ~ ., data = penguins_train)
  mr_cls_fit
  ```

  The holdout data can be predicted for both hard class predictions and probabilities. We'll bind these together into one tibble:

  ```{r}
  bind_cols(
    predict(mr_cls_fit, penguins_test),
    predict(mr_cls_fit, penguins_test, type = "prob")
  )
  ```

  </details>


  <details id="nearest-neighbor-kknn"> 

  <summary><code>nearest_neighbor<foo></foo>()</code> with the `"kknn"` engine</summary>

  ```{r echo=FALSE}
  knitr::spin_child("template-reg-chicago.R")
  ```

  We can define the model with specific parameters:

  ```{r}
  knn_reg_spec <-
    nearest_neighbor(neighbors = 5, weight_func = "triangular") %>%
    # This model can be used for classification or regression, so set mode
    set_mode("regression") %>%
    set_engine("kknn")
  knn_reg_spec
  ```

  Now we create the model fit object:

  ```{r}
  knn_reg_fit <- knn_reg_spec %>% fit(ridership ~ ., data = Chicago_train)
  knn_reg_fit
  ```

  The holdout data can be predicted:

  ```{r}
  predict(knn_reg_fit, Chicago_test)
  ```


  ```{r echo=FALSE}
  knitr::spin_child("template-cls-two-class.R")
  ```

  Since there are two classes, we'll use an odd number of neighbors to avoid ties:

  ```{r}
  knn_cls_spec <-
    nearest_neighbor(neighbors = 11, weight_func = "triangular") %>%
    # This model can be used for classification or regression, so set mode
    set_mode("classification") %>%
    set_engine("kknn")
  knn_cls_spec
  ```

  Now we create the model fit object:

  ```{r}
  knn_cls_fit <- knn_cls_spec %>% fit(Class ~ ., data = data_train)
  knn_cls_fit
  ```

  The holdout data can be predicted for both hard class predictions and probabilities. We'll bind these together into one tibble:

  ```{r}
  bind_cols(
    predict(knn_cls_fit, data_test),
    predict(knn_cls_fit, data_test, type = "prob")
  )
  ```
  
  </details>


  <details id="rand-forest-ranger"> 
  
  <summary><code>rand_forest<foo></foo>()</code> with the `"ranger"` engine</summary>

  ```{r echo=FALSE}
  knitr::spin_child("template-reg-chicago.R")
  ```

  We can define the model with specific parameters:

  ```{r}
  rf_reg_spec <- 
    rand_forest(trees = 200, min_n = 5) %>% 
    # This model can be used for classification or regression, so set mode
    set_mode("regression") %>% 
    set_engine("ranger")
  rf_reg_spec
  ```

  Now we create the model fit object:

  ```{r}
  set.seed(1)
  rf_reg_fit <- rf_reg_spec %>% fit(ridership ~ ., data = Chicago_train)
  rf_reg_fit
  ```

  The holdout data can be predicted:

  ```{r}
  predict(rf_reg_fit, Chicago_test)
  ```


  ```{r echo=FALSE}
  knitr::spin_child("template-cls-two-class.R")
  ```

  We can define the model with specific parameters:

  ```{r}
  rf_cls_spec <- 
    rand_forest(trees = 200, min_n = 5) %>% 
    # This model can be used for classification or regression, so set mode
    set_mode("classification") %>% 
    set_engine("ranger")
  rf_cls_spec
  ```

  Now we create the model fit object:

  ```{r}
  set.seed(1)
  rf_cls_fit <- rf_cls_spec %>% fit(Class ~ ., data = data_train)
  rf_cls_fit
  ```

  The holdout data can be predicted for both hard class predictions and probabilities. We'll bind these together into one tibble:

  ```{r}
  bind_cols(
    predict(rf_cls_fit, data_test),
    predict(rf_cls_fit, data_test, type = "prob")
  )
  ```
    
  </details>


  <details id="rand-forest-randomForest"> 
  
  <summary><code>rand_forest<foo></foo>()</code> with the `"randomForest"` engine</summary>

  ```{r echo=FALSE}
  knitr::spin_child("template-reg-chicago.R")
  ```

  We can define the model with specific parameters:

  ```{r}
  rf_reg_spec <- 
    rand_forest(trees = 200, min_n = 5) %>% 
    # This model can be used for classification or regression, so set mode
    set_mode("regression") %>% 
    set_engine("randomForest")
  rf_reg_spec
  ```

  Now we create the model fit object:

  ```{r}
  set.seed(1)
  rf_reg_fit <- rf_reg_spec %>% fit(ridership ~ ., data = Chicago_train)
  rf_reg_fit
  ```

  The holdout data can be predicted:

  ```{r}
  predict(rf_reg_fit, Chicago_test)
  ```


  ```{r echo=FALSE}
  knitr::spin_child("template-cls-two-class.R")
  ```

  We can define the model with specific parameters:

  ```{r}
  rf_cls_spec <- 
    rand_forest(trees = 200, min_n = 5) %>% 
    # This model can be used for classification or regression, so set mode
    set_mode("classification") %>% 
    set_engine("randomForest")
  rf_cls_spec
  ```

  Now we create the model fit object:

  ```{r}
  set.seed(1)
  rf_cls_fit <- rf_cls_spec %>% fit(Class ~ ., data = data_train)
  rf_cls_fit
  ```

  The holdout data can be predicted for both hard class predictions and probabilities. We'll bind these together into one tibble:

  ```{r}
  bind_cols(
    predict(rf_cls_fit, data_test),
    predict(rf_cls_fit, data_test, type = "prob")
  )
  ```
    
  </details>


  <details id="svm-linear-LiblineaR">
  
  <summary><code>svm_linear<foo></foo>()</code> with the `"LiblineaR"` engine</summary>

  ```{r echo=FALSE}
  knitr::spin_child("template-reg-chicago.R")
  ```

  We can define the model with specific parameters:

  ```{r}
  svm_reg_spec <- 
    svm_linear(cost = 1, margin = 0.1) %>% 
    # This model can be used for classification or regression, so set mode
    set_mode("regression") %>% 
    set_engine("LiblineaR")
  svm_reg_spec
  ```

  Now we create the model fit object:

  ```{r}
  set.seed(1)
  svm_reg_fit <- svm_reg_spec %>% fit(ridership ~ ., data = Chicago_train)
  svm_reg_fit
  ```

  The holdout data can be predicted:

  ```{r}
  predict(svm_reg_fit, Chicago_test)
  ```


  ```{r echo=FALSE}
  knitr::spin_child("template-cls-two-class.R")
  ```

  We can define the model with specific parameters:

  ```{r}
  svm_cls_spec <- 
    svm_linear(cost = 1) %>% 
    # This model can be used for classification or regression, so set mode
    set_mode("classification") %>% 
    set_engine("LiblineaR")
  svm_cls_spec
  ```

  Now we create the model fit object:

  ```{r}
  set.seed(1)
  svm_cls_fit <- svm_cls_spec %>% fit(Class ~ ., data = data_train)
  svm_cls_fit
  ```

  The holdout data can be predicted for hard class predictions.

  ```{r}
  predict(svm_cls_fit, data_test)
  ```

  </details>


  <details id="svm-linear-kernlab"> 
  
  <summary><code>svm_linear<foo></foo>()</code> with the `"kernlab"` engine</summary>

  ```{r echo=FALSE}
  knitr::spin_child("template-reg-chicago.R")
  ```

  We can define the model with specific parameters:

  ```{r}
  svm_reg_spec <- 
    svm_linear(cost = 1, margin = 0.1) %>% 
    # This model can be used for classification or regression, so set mode
    set_mode("regression") %>% 
    set_engine("kernlab")
  svm_reg_spec
  ```

  Now we create the model fit object:

  ```{r}
  set.seed(1)
  svm_reg_fit <- svm_reg_spec %>% fit(ridership ~ ., data = Chicago_train)
  svm_reg_fit
  ```

  The holdout data can be predicted:

  ```{r}
  predict(svm_reg_fit, Chicago_test)
  ```


  ```{r echo=FALSE}
  knitr::spin_child("template-cls-two-class.R")
  ```

  We can define the model with specific parameters:

  ```{r}
  svm_cls_spec <- 
    svm_linear(cost = 1) %>% 
    # This model can be used for classification or regression, so set mode
    set_mode("classification") %>% 
    set_engine("kernlab")
  svm_cls_spec
  ```

  Now we create the model fit object:

  ```{r}
  set.seed(1)
  svm_cls_fit <- svm_cls_spec %>% fit(Class ~ ., data = data_train)
  svm_cls_fit
  ```

  The holdout data can be predicted for both hard class predictions and probabilities. We'll bind these together into one tibble:

  ```{r}
  bind_cols(
    predict(svm_cls_fit, data_test),
    predict(svm_cls_fit, data_test, type = "prob")
  )
  ```
    
  </details>


  <details id="svm-poly-kernlab">
  
  <summary><code>svm_poly<foo></foo>()</code> with the `"kernlab"` engine</summary>

  ```{r echo=FALSE}
  knitr::spin_child("template-reg-chicago.R")
  ```

  We can define the model with specific parameters:

  ```{r}
  svm_reg_spec <- 
    svm_poly(cost = 1, margin = 0.1) %>% 
    # This model can be used for classification or regression, so set mode
    set_mode("regression") %>% 
    set_engine("kernlab")
  svm_reg_spec
  ```

  Now we create the model fit object:

  ```{r}
  set.seed(1)
  svm_reg_fit <- svm_reg_spec %>% fit(ridership ~ ., data = Chicago_train)
  svm_reg_fit
  ```

  The holdout data can be predicted:

  ```{r}
  predict(svm_reg_fit, Chicago_test)
  ```


  ```{r echo=FALSE}
  knitr::spin_child("template-cls-two-class.R")
  ```

  We can define the model with specific parameters:

  ```{r}
  svm_cls_spec <- 
    svm_poly(cost = 1) %>% 
    # This model can be used for classification or regression, so set mode
    set_mode("classification") %>% 
    set_engine("kernlab")
  svm_cls_spec
  ```

  Now we create the model fit object:

  ```{r}
  set.seed(1)
  svm_cls_fit <- svm_cls_spec %>% fit(Class ~ ., data = data_train)
  svm_cls_fit
  ```

  The holdout data can be predicted for both hard class predictions and probabilities. We'll bind these together into one tibble:

  ```{r}
  bind_cols(
    predict(svm_cls_fit, data_test),
    predict(svm_cls_fit, data_test, type = "prob")
  )
  ```
    
  </details>


  <details id="svm-rbf-kernlab"> 

  <summary><code>svm_rbf<foo></foo>()</code> with the `"kernlab"` engine</summary>

  ```{r echo=FALSE}
  knitr::spin_child("template-reg-chicago.R")
  ```

  We can define the model with specific parameters:

  ```{r}
  svm_reg_spec <- 
    svm_rbf(cost = 1, margin = 0.1) %>% 
    # This model can be used for classification or regression, so set mode
    set_mode("regression") %>% 
    set_engine("kernlab")
  svm_reg_spec
  ```

  Now we create the model fit object:

  ```{r}
  set.seed(1)
  svm_reg_fit <- svm_reg_spec %>% fit(ridership ~ ., data = Chicago_train)
  svm_reg_fit
  ```

  The holdout data can be predicted:

  ```{r}
  predict(svm_reg_fit, Chicago_test)
  ```


  ```{r echo=FALSE}
  knitr::spin_child("template-cls-two-class.R")
  ```

  We can define the model with specific parameters:

  ```{r}
  svm_cls_spec <- 
    svm_rbf(cost = 1) %>% 
    # This model can be used for classification or regression, so set mode
    set_mode("classification") %>% 
    set_engine("kernlab")
  svm_cls_spec
  ```

  Now we create the model fit object:

  ```{r}
  set.seed(1)
  svm_cls_fit <- svm_cls_spec %>% fit(Class ~ ., data = data_train)
  svm_cls_fit
  ```

  The holdout data can be predicted for both hard class predictions and probabilities. We'll bind these together into one tibble:

  ```{r}
  bind_cols(
    predict(svm_cls_fit, data_test),
    predict(svm_cls_fit, data_test, type = "prob")
  )
  ```
    
  </details>


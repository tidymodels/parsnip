<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Linear quantile regression via the quantreg package — details_linear_reg_quantreg • parsnip</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.9/font.css" rel="stylesheet"><link href="../deps/Source_Code_Pro-0.4.9/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Linear quantile regression via the quantreg package — details_linear_reg_quantreg"><meta name="description" content="quantreg::rq() optimizes quantile loss to fit models with numeric outcomes."><meta property="og:description" content="quantreg::rq() optimizes quantile loss to fit models with numeric outcomes."><meta property="og:image" content="https://parsnip.tidymodels.org/logo.png"><meta name="robots" content="noindex"><script defer data-domain="parsnip.tidymodels.org,all.tidymodels.org" src="https://plausible.io/js/plausible.js"></script></head><body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">parsnip</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.3.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/parsnip.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/checklists.html">Dev checklists</a></li>
    <li><a class="dropdown-item" href="../articles/Examples.html">Fitting and predicting with parsnip</a></li>
    <li><a class="dropdown-item" href="../articles/Submodels.html">Evaluating submodels with the same model object</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-learn-more" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Learn more</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-learn-more"><li><a class="external-link dropdown-item" href="https://www.tidymodels.org/learn/models/parsnip-ranger-glmnet/">Regression modeling</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidymodels.org/learn/models/parsnip-nnet/">Classification modeling</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidymodels.org/learn/develop/models/">Making a parsnip model from scratch</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/tidymodels/parsnip/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic" id="container">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Linear quantile regression via the quantreg package</h1>
      <small class="dont-index">Source: <a href="https://github.com/tidymodels/parsnip/blob/main/R/linear_reg_quantreg.R" class="external-link"><code>R/linear_reg_quantreg.R</code></a></small>
      <div class="d-none name"><code>details_linear_reg_quantreg.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code><a href="https://rdrr.io/pkg/quantreg/man/rq.html" class="external-link">quantreg::rq()</a></code> optimizes quantile loss to fit models with numeric outcomes.</p>
    </div>


    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>For this engine, there is a single mode: quantile regression</p>
<p>This model has the same structure as the model fit by <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code>, but
instead of optimizing the sum of squared errors, it optimizes “quantile
loss” in order to produce better estimates of the predictive
distribution.</p><div class="section">
<h3 id="tuning-parameters">Tuning Parameters<a class="anchor" aria-label="anchor" href="#tuning-parameters"></a></h3>


<p>This engine has no tuning parameters.</p>
</div>

<div class="section">
<h3 id="translation-from-parsnip-to-the-original-package">Translation from parsnip to the original package<a class="anchor" aria-label="anchor" href="#translation-from-parsnip-to-the-original-package"></a></h3>


<p>This model only works with the <code>"quantile regression"</code> model and
requires users to specify which areas of the distribution to predict via
the <code>quantile_levels</code> argument. For example:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="../reference/linear_reg.html">linear_reg</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/set_engine.html">set_engine</a></span><span class="op">(</span><span class="st">"quantreg"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/set_args.html">set_mode</a></span><span class="op">(</span><span class="st">"quantile regression"</span>, quantile_levels <span class="op">=</span> <span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span> <span class="op">/</span> <span class="fl">4</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/translate.html">translate</a></span><span class="op">(</span><span class="op">)</span></span></code></pre><p></p></div>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="do">## Linear Regression Model Specification (quantile regression)</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="do">## Computational engine: quantreg</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="do">## Model fit template:</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="do">## quantreg::rq(formula = missing_arg(), data = missing_arg(), weights = missing_arg(),</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="do">##     tau = quantile_levels)</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="do">## Quantile levels: 0.25, 0.5, and 0.75.</span></span></code></pre><p></p></div>
</div>

<div class="section">
<h3 id="output-format">Output format<a class="anchor" aria-label="anchor" href="#output-format"></a></h3>


<p>When multiple quantile levels are predicted, there are multiple
predicted values for each row of new data. The <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code> method for
this mode produces a column named <code>.pred_quantile</code> that has a special
class of <code>"quantile_pred"</code>, and it contains the predictions for each
row.</p>
<p>For example:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://modeldata.tidymodels.org" class="external-link">modeldata</a></span><span class="op">)</span></span>
<span><span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/is_installed.html" class="external-link">check_installed</a></span><span class="op">(</span><span class="st">"quantreg"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Chicago</span><span class="op">)</span></span>
<span><span class="va">Chicago</span> <span class="op">&lt;-</span> <span class="va">Chicago</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">ridership</span>, <span class="va">Clark_Lake</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Chicago_train</span> <span class="op">&lt;-</span> <span class="va">Chicago</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n</span> <span class="op">-</span> <span class="fl">7</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="va">Chicago_test</span>  <span class="op">&lt;-</span> <span class="va">Chicago</span><span class="op">[</span><span class="op">(</span><span class="va">n</span> <span class="op">-</span> <span class="fl">6</span><span class="op">)</span><span class="op">:</span><span class="va">n</span>, <span class="op">]</span></span>
<span></span>
<span><span class="va">qr_fit</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/linear_reg.html">linear_reg</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/set_engine.html">set_engine</a></span><span class="op">(</span><span class="st">"quantreg"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/set_args.html">set_mode</a></span><span class="op">(</span><span class="st">"quantile regression"</span>, quantile_levels <span class="op">=</span> <span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span> <span class="op">/</span> <span class="fl">4</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fit</a></span><span class="op">(</span><span class="va">ridership</span> <span class="op">~</span> <span class="va">Clark_Lake</span>, data <span class="op">=</span> <span class="va">Chicago_train</span><span class="op">)</span></span>
<span><span class="va">qr_fit</span></span></code></pre><p></p></div>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="do">## parsnip model object</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="do">## Call:</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="do">## quantreg::rq(formula = ridership ~ Clark_Lake, tau = quantile_levels,</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="do">##     data = data)</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="do">## Coefficients:</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="do">##              tau= 0.25 tau= 0.50 tau= 0.75</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="do">## (Intercept) -0.2064189 0.2051549 0.8112286</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="do">## Clark_Lake   0.9820582 0.9862306 0.9777820</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a><span class="do">## Degrees of freedom: 5691 total; 5689 residual</span></span></code></pre><p></p></div>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">qr_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">qr_fit</span>, <span class="va">Chicago_test</span><span class="op">)</span></span>
<span><span class="va">qr_pred</span></span></code></pre><p></p></div>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="do">## # A tibble: 7 x 1</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="do">##   .pred_quantile</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="do">##        &lt;qtls(3)&gt;</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="do">## 1         [21.1]</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="do">## 2         [21.4]</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="do">## 3         [21.7]</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="do">## 4         [21.4]</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="do">## 5         [19.5]</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="do">## 6         [6.88]</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="do">## # i 1 more row</span></span></code></pre><p></p></div>
<p>We can unnest these values and/or convert them to a rectangular format:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">qr_pred</span><span class="op">$</span><span class="va">.pred_quantile</span><span class="op">)</span></span></code></pre><p></p></div>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="do">## # A tibble: 21 x 3</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="do">##   .pred_quantile .quantile_levels  .row</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="do">##            &lt;dbl&gt;            &lt;dbl&gt; &lt;int&gt;</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="do">## 1           20.6             0.25     1</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="do">## 2           21.1             0.5      1</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="do">## 3           21.5             0.75     1</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="do">## 4           20.9             0.25     2</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="do">## 5           21.4             0.5      2</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="do">## 6           21.8             0.75     2</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="do">## # i 15 more rows</span></span></code></pre><p></p></div>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">qr_pred</span><span class="op">$</span><span class="va">.pred_quantile</span><span class="op">)</span></span></code></pre><p></p></div>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="do">##           [,1]      [,2]      [,3]</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="do">## [1,] 20.590627 21.090561 21.517717</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="do">## [2,] 20.863639 21.364733 21.789541</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="do">## [3,] 21.190665 21.693148 22.115142</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="do">## [4,] 20.879352 21.380513 21.805185</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="do">## [5,] 19.047814 19.541193 19.981622</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="do">## [6,]  6.435241  6.875033  7.423968</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="do">## [7,]  6.062058  6.500265  7.052411</span></span></code></pre><p></p></div>
</div>

<div class="section">
<h3 id="preprocessing-requirements">Preprocessing requirements<a class="anchor" aria-label="anchor" href="#preprocessing-requirements"></a></h3>


<p>Factor/categorical predictors need to be converted to numeric values
(e.g., dummy or indicator variables) for this engine. When using the
formula method via <code><a href="fit.html">fit()</a></code>, parsnip will
convert factor columns to indicators.</p>
</div>

<div class="section">
<h3 id="case-weights">Case weights<a class="anchor" aria-label="anchor" href="#case-weights"></a></h3>


<p>This model can utilize case weights during model fitting. To use them,
see the documentation in <a href="case_weights.html">case_weights</a> and the examples
on <code>tidymodels.org</code>.</p>
<p>The <code><a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fit()</a></code> and <code><a href="https://generics.r-lib.org/reference/fit_xy.html" class="external-link">fit_xy()</a></code> arguments have arguments called
<code>case_weights</code> that expect vectors of case weights.</p>
</div>

<div class="section">
<h3 id="saving-fitted-model-objects">Saving fitted model objects<a class="anchor" aria-label="anchor" href="#saving-fitted-model-objects"></a></h3>


<p>This model object contains data that are not required to make
predictions. When saving the model for the purpose of prediction, the
size of the saved object might be substantially reduced by using
functions from the <a href="https://butcher.tidymodels.org" class="external-link">butcher</a> package.</p>
</div>

<div class="section">
<h3 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a></h3>


<p>The “Fitting and Predicting with parsnip” article contains
<a href="https://parsnip.tidymodels.org/articles/articles/Examples.html#linear-reg-quantreg">examples</a>
for <code><a href="linear_reg.html">linear_reg()</a></code> with the <code>"quantreg"</code> engine.</p>
</div>

<div class="section">
<h3 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h3>

<ul><li><p>Waldmann, E. (2018). Quantile regression: a short story on how and
why. <em>Statistical Modelling</em>, 18(3-4), 203-218.</p></li>
</ul></div>

    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/topepo" class="external-link">Max Kuhn</a>, <a href="https://github.com/DavisVaughan" class="external-link">Davis Vaughan</a>, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

  </div></footer></body></html>

